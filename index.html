<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>AI Mentor ‚Äì H∆∞·ªõng nghi·ªáp th√¥ng minh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- FONT -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
  :root{
    --bg:#f6f7fb;
    --panel:#ffffff;
    --primary:#4f46e5;
    --primary-soft:#eef2ff;
    --text:#0f172a;
    --muted:#64748b;
    --border:#e5e7eb;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:"Inter",system-ui,-apple-system;
  }

  /* ===== APP LAYOUT ===== */
  .app{
    display:flex;
    min-height:100vh;
  }

  /* ===== SIDEBAR ===== */
  .sidebar{
    width:260px;
    background:var(--panel);
    border-right:1px solid var(--border);
    padding:28px 24px;
  }

  .brand{
    font-size:20px;
    font-weight:700;
    margin-bottom:28px;
  }

  .steps{
    list-style:none;
    padding:0;
    margin:0;
  }

  .steps li{
    padding:12px 14px;
    border-radius:12px;
    margin-bottom:8px;
    font-size:14px;
    color:var(--muted);
  }

  .steps li.active{
    background:var(--primary-soft);
    color:var(--primary);
    font-weight:600;
  }

  /* ===== MAIN ===== */
    .main{
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px;
    }

    .container{
    width:100%;
    max-width:720px;
    }


  /* ===== CARD ===== */
  .card{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:20px;
    padding:32px;
    animation:fade .35s ease;
  }

  .hidden{display:none}

  h2{
    margin:0 0 8px;
    font-size:24px;
  }

  p{
    margin:0 0 22px;
    color:var(--muted);
  }

  /* ===== INPUT ===== */
  label{
    display:block;
    margin:18px 0 8px;
    font-weight:600;
  }

  input[type="text"], textarea{
    width:100%;
    padding:14px 16px;
    border-radius:14px;
    border:1px solid var(--border);
    font-size:14px;
    font-family:inherit;
  }

  textarea{min-height:90px}

  /* ===== OPTION CARD ===== */
  .option{
    border:1px solid var(--border);
    border-radius:16px;
    padding:14px 18px;
    margin:10px 0;
    cursor:pointer;
    transition:.15s ease;
    font-size:14px;
    display:flex;
    align-items:center;
    gap:12px;
  }

  .option input{display:none}

  .option::before{
    content:"";
    width:16px;
    height:16px;
    border-radius:50%;
    border:2px solid var(--border);
    flex-shrink:0;
  }

  .option:hover{
    border-color:var(--primary);
    background:var(--primary-soft);
  }

  .option.selected{
    border-color:var(--primary);
    background:var(--primary-soft);
  }

  .option.selected::before{
    background:var(--primary);
    border-color:var(--primary);
  }

  /* ===== BUTTON ===== */
  button{
    margin-top:26px;
    background:var(--primary);
    color:white;
    padding:14px 26px;
    border-radius:16px;
    border:none;
    font-weight:600;
    font-size:15px;
    cursor:pointer;
  }

  button:hover{opacity:.95}

  /* ===== ANIMATION ===== */
  @keyframes fade{
    from{opacity:0;transform:translateY(8px)}
    to{opacity:1;transform:none}
  }

/* ===== HERO INTRO ===== */
.hero{
  min-height: calc(100vh - 96px);
  display:flex;
  align-items:center;
  justify-content:center;
}

.hero-card{
  max-width:520px;
  width:100%;
  padding:48px 44px;
  border-radius:28px;
  background:linear-gradient(180deg,#ffffff,#f8f9ff);
  border:1px solid var(--border);
  text-align:center;
  animation:fade .5s ease;
}

.hero-badge{
  display:inline-block;
  padding:6px 14px;
  border-radius:999px;
  font-size:13px;
  font-weight:600;
  background:var(--primary-soft);
  color:var(--primary);
  margin-bottom:18px;
}

.hero-title{
  font-size:34px;
  font-weight:800;
  line-height:1.2;
  margin-bottom:12px;
}

.hero-desc{
  font-size:16px;
  color:var(--muted);
  margin-bottom:34px;
}

.hero-input{
  margin-bottom:18px;
}

.hero-input input{
  text-align:center;
  font-size:16px;
}

.hero-btn{
  width:100%;
  padding:16px;
  font-size:16px;
  border-radius:18px;
}

.hero-note{
  margin-top:18px;
  font-size:13px;
  color:var(--muted);
}
/* ===== INTRO SCREEN ===== */
.intro{
  position:fixed;
  inset:0;
  z-index:1000;
  display:flex;
  align-items:center;
  justify-content:center;
  background:
    radial-gradient(1200px 600px at 50% -10%, #eef2ff, transparent),
    var(--bg);
}

.intro-card{
  width:100%;
  max-width:520px;
  background:white;
  border-radius:28px;
  padding:48px 48px 42px;
  text-align:center;
  box-shadow:
    0 20px 40px rgba(15,23,42,.08),
    0 4px 10px rgba(15,23,42,.04);
}


.intro-logo{
  font-size:36px;
  font-weight:800;
  letter-spacing:.08em;
  margin-bottom:6px;
}

.intro-tagline{
  font-size:14px;
  font-weight:600;
  color:var(--primary);
  margin-bottom:20px;
}

.intro-desc{
  font-size:15px;
  line-height:1.7;
  color:var(--muted);
  margin-bottom:28px;
}


.intro-input{
  margin-bottom:20px;
}

.intro-input input{
  width:100%;
  padding:16px 18px;
  border-radius:14px;
  border:1px solid var(--border);
  font-size:15px;
  text-align:center;
  margin-bottom:26px;
}

.intro-btn{
  width:100%;
  padding:16px;
  border-radius:16px;
  font-size:16px;
  font-weight:700;
}


.intro-note{
  margin-top:22px;
  font-size:13px;
  color:var(--muted);
}

/* ===== ANIMATION ===== */
@keyframes introEnter{
  from{
    opacity:0;
    transform:translateY(24px) scale(.96);
    filter:blur(6px);
  }
  to{
    opacity:1;
    transform:none;
    filter:none;
  }
}

.option{ outline:none }
.option:focus{
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-soft);
}

  </style>
</head>

<body>
    <!-- ================= INTRO / MODULE 0 ================= -->
<div id="m0" class="intro">
  <div class="intro-card">
    <div class="intro-logo">LUMEN</div>

    <div class="intro-tagline">
      AI Career Mentor for Grade 12 Students
    </div>

    <div class="intro-desc">
      LUMEN gi√∫p em <b>hi·ªÉu r√µ b·∫£n th√¢n</b>,<br>
      ph√¢n t√≠ch t∆∞ duy ‚Äì t√≠nh c√°ch ‚Äì nƒÉng l·ª±c<br>
      v√† g·ª£i √Ω <b>ng√†nh ngh·ªÅ & l·ªô tr√¨nh h·ªçc t·∫≠p ph√π h·ª£p</b>.
    </div>

    <div class="intro-input">
      <input id="name" type="text" placeholder="Nh·∫≠p t√™n c·ªßa em ƒë·ªÉ b·∫Øt ƒë·∫ßu">
    </div>

    <button class="intro-btn" onclick="submitM0()">
      üöÄ B·∫Øt ƒë·∫ßu h√†nh tr√¨nh c√πng LUMEN
    </button>

    <div class="intro-note">
      ‚è± ~10 ph√∫t ‚Ä¢ Kh√¥ng ƒë√∫ng‚Äìsai ‚Ä¢ Ho√†n to√†n b·∫£o m·∫≠t
    </div>
  </div>
</div>

<div id="app" class="app hidden">
  <!-- MAIN -->
  <main class="main">
    <div class="container">
      <!-- ================= MODULE 1 ================= -->
        <div id="m1" class="card hidden">
        <h2>Em h·ªçc v√† l√†m vi·ªác nh∆∞ th·∫ø n√†o?</h2>
        <p>Kh√¥ng c√≥ ƒë√∫ng ‚Äì sai. Ch·ªâ c·∫ßn ch·ªçn ƒëi·ªÅu gi·ªëng em nh·∫•t.</p>

        <!-- ===== C√ÇU 1 ===== -->
        <label>Ho·∫°t ƒë·ªông em h·ª©ng th√∫ (ch·ªçn t·ªëi ƒëa 3)</label>

        <div class="option" onclick="toggleCheckbox(this)">
            <input type="checkbox" value="Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ logic">
            Gi·∫£i b√†i kh√≥, suy lu·∫≠n
        </div>

        <div class="option" onclick="toggleCheckbox(this)">
            <input type="checkbox" value="C√¥ng ngh·ªá & m√°y t√≠nh">
            C√¥ng ngh·ªá, m√°y t√≠nh
        </div>

        <div class="option" onclick="toggleCheckbox(this)">
            <input type="checkbox" value="Vi·∫øt & tr√¨nh b√†y">
            Vi·∫øt, n√≥i, thuy·∫øt tr√¨nh
        </div>

        <div class="option" onclick="toggleCheckbox(this)">
            <input type="checkbox" value="Thi·∫øt k·∫ø & s√°ng t·∫°o">
            Thi·∫øt k·∫ø, s√°ng t·∫°o
        </div>

        <div class="option" onclick="toggleCheckbox(this)">
            <input type="checkbox" value="Gi√∫p ƒë·ª° ng∆∞·ªùi kh√°c">
            Gi√∫p ƒë·ª°, h·ªó tr·ª£ ng∆∞·ªùi kh√°c
        </div>

        <!-- ===== FIELD B·∫ÆT BU·ªòC CHO SCRIPT (·∫®N) ===== -->
        <!-- Script submitM1 C·∫¶N C√ÅC FIELD N√ÄY -->
        <input type="radio" name="learning" value="" hidden checked>
        <input type="radio" name="workEnv" value="" hidden checked>
        <textarea id="studyPain" hidden></textarea>

        <button onclick="submitM1()">Ti·∫øp t·ª•c</button>
        </div>


      <!-- ================= MODULE 2 ================= -->
    <!-- ================= MODULE 2 ================= -->
    <div id="m2" class="card hidden">
    <h2>Em l√† ng∆∞·ªùi nh∆∞ th·∫ø n√†o?</h2>
    <p>H√£y tr·∫£ l·ªùi th·∫≠t, kh√¥ng ai ch·∫•m ƒëi·ªÉm em c·∫£.</p>

    <!-- ===== C√ÇU 5 ===== -->
    <label>Em c·∫£m th·∫•y m√¨nh l√† ng∆∞·ªùi:</label>

    <div class="option" onclick="toggleRadio(this)">
        <input type="radio" name="personality" value="H∆∞·ªõng n·ªôi">
        H∆∞·ªõng n·ªôi
    </div>

    <div class="option" onclick="toggleRadio(this)">
        <input type="radio" name="personality" value="H∆∞·ªõng ngo·∫°i">
        H∆∞·ªõng ngo·∫°i
    </div>

    <div class="option" onclick="toggleRadio(this)">
        <input type="radio" name="personality" value="C√¢n b·∫±ng">
        C√¢n b·∫±ng
    </div>

    <!-- ===== C√ÇU 6 ===== -->
    <label>ƒê·∫∑c ƒëi·ªÉm n√†o m√¥ t·∫£ em ƒë√∫ng nh·∫•t? (ch·ªçn 2‚Äì3)</label>

    <div class="option" onclick="toggleCheckbox(this)">
        <input type="checkbox" value="C·∫©n th·∫≠n">
        C·∫©n th·∫≠n
    </div>

    <div class="option" onclick="toggleCheckbox(this)">
        <input type="checkbox" value="S√°ng t·∫°o">
        S√°ng t·∫°o
    </div>

    <div class="option" onclick="toggleCheckbox(this)">
        <input type="checkbox" value="Ki√™n tr√¨">
        Ki√™n tr√¨
    </div>

    <div class="option" onclick="toggleCheckbox(this)">
        <input type="checkbox" value="Giao ti·∫øp t·ªët">
        Giao ti·∫øp t·ªët
    </div>

    <div class="option" onclick="toggleCheckbox(this)">
        <input type="checkbox" value="T∆∞ duy logic">
        T∆∞ duy logic
    </div>

    <!-- ===== TEXTAREA B·∫ÆT BU·ªòC CHO SCRIPT ===== -->
    <label>ƒêi·ªÉm m·∫°nh l·ªõn nh·∫•t c·ªßa em</label>
    <textarea id="strengths"></textarea>

    <label>ƒêi·ªÅu khi·∫øn em hay t·ª± ti ho·∫∑c tr√¨ ho√£n</label>
    <textarea id="weaknesses"></textarea>

    <label>ƒêi·ªÅu em lo nh·∫•t khi ch·ªçn ng√†nh</label>
    <textarea id="careerFear"></textarea>

    <button onclick="submitM2()">Ti·∫øp t·ª•c</button>
    </div>

    <!-- ================= MODULE 3A ‚Äì MI ================= -->
    <div id="m3a" class="card hidden">
    <h2>ƒêa tr√≠ tu·ªá (MI)</h2>
    <p>Ch·ªçn ph∆∞∆°ng √°n gi·ªëng em nh·∫•t cho m·ªói c√¢u h·ªèi.</p>

    <!-- ‚ùó B·∫ÆT BU·ªòC: script renderMI() s·∫Ω b∆°m HTML v√†o ƒë√¢y -->
    <div id="miContainer"></div>

    <button onclick="submitMI()">Ti·∫øp t·ª•c</button>
    </div>


    <!-- ================= MODULE 3B ‚Äì HOLLAND ================= -->
    <div id="m3b" class="card hidden">
    <h2>M√¥i tr∆∞·ªùng ngh·ªÅ nghi·ªáp (Holland)</h2>
    <p>Ch·ªçn ph∆∞∆°ng √°n m√¥ t·∫£ m√¥i tr∆∞·ªùng c√¥ng vi·ªác em th·∫•y ph√π h·ª£p.</p>

    <!-- ‚ùó B·∫ÆT BU·ªòC: renderHolland() s·∫Ω ƒë·ªï c√¢u h·ªèi v√†o ƒë√¢y -->
    <div id="hollandContainer"></div>

    <button onclick="submitHolland()">Ti·∫øp t·ª•c</button>
    </div>


    <!-- ================= MODULE 3C ‚Äì SWOT ================= -->
<div id="m3c" class="card hidden">
  <h2>SWOT c√° nh√¢n</h2>
  <p>
    Ph·∫ßn n√†y gi√∫p AI hi·ªÉu th√™m v·ªÅ g√≥c nh√¨n c√° nh√¢n c·ªßa em.
    Kh√¥ng c·∫ßn vi·∫øt d√†i, ch·ªâ c·∫ßn th·∫≠t.
  </p>

  <!-- ‚ùó C√°c id n√†y script submitSWOT() ƒëang D√ôNG TR·ª∞C TI·∫æP -->

  <label>Strengths ‚Äì ƒêi·ªÉm m·∫°nh</label>
  <textarea
    id="swot_strengths"
    placeholder="V√≠ d·ª•: chƒÉm ch·ªâ, h·ªçc nhanh, t∆∞ duy logic..."
  ></textarea>

  <label>Weaknesses ‚Äì H·∫°n ch·∫ø</label>
  <textarea
    id="swot_weaknesses"
    placeholder="V√≠ d·ª•: d·ªÖ n·∫£n, thi·∫øu k·ª∑ lu·∫≠t, hay tr√¨ ho√£n..."
  ></textarea>

  <label>Opportunities ‚Äì C∆° h·ªôi</label>
  <textarea
    id="swot_opportunities"
    placeholder="V√≠ d·ª•: gia ƒë√¨nh ·ªßng h·ªô, c√≥ th·ªùi gian h·ªçc th√™m, tr∆∞·ªùng t·ªët..."
  ></textarea>

  <label>Threats ‚Äì Th√°ch th·ª©c</label>
  <textarea
    id="swot_threats"
    placeholder="V√≠ d·ª•: √°p l·ª±c ƒëi·ªÉm s·ªë, c·∫°nh tranh cao, thi·∫øu ƒë·ªãnh h∆∞·ªõng..."
  ></textarea>

  <button onclick="submitSWOT()">Ho√†n t·∫•t & Ph√¢n t√≠ch</button>
</div>

      <!-- ================= DEBUG (·∫®N) ================= -->
      <div id="debug" class="card hidden" style="display:none"></div>

    </div>
  </main>
</div>


<!-- ================= SCRIPT ================= -->
<script>

"use strict";

function go(a, b){
  $(a).classList.add("hidden");
  $(b).classList.remove("hidden");
}


function showOnly(id){
  document.querySelectorAll(".card").forEach(c=>{
    c.classList.add("hidden");
  });
  document.getElementById(id).classList.remove("hidden");
}


function goAnalyze(){
  saveStudent(); // ƒë√£ c√≥ s·∫µn
  window.location.href = "analyze.html";
}

/* ================= HELPER ================= */
const $ = (id) => document.getElementById(id);



/* ===== OPTION CARD HANDLER (GLOBAL FIX) ===== */

function toggleCheckbox(el){
  const input = el.querySelector("input[type='checkbox']");
  if(!input) return;

  const container = el.closest(".card");
  const checkedCount = container.querySelectorAll(
    "input[type='checkbox']:checked"
  ).length;

  // N·∫øu ƒëang ch·ªçn v√† ƒë√£ ƒë·ªß 3 ‚Üí ch·∫∑n
  if(!input.checked && checkedCount >= 3){
    alert("B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 3 l·ª±a ch·ªçn.");
    return;
  }

  input.checked = !input.checked;
  el.classList.toggle("selected", input.checked);
}


function toggleRadio(el){
  const input = el.querySelector("input[type='radio']");
  if(!input) return;

  // clear c√°c option c√πng name
  document
    .querySelectorAll(`input[name="${input.name}"]`)
    .forEach(r=>{
      r.checked = false;
      r.closest(".option")?.classList.remove("selected");
    });

  input.checked = true;
  el.classList.add("selected");
}

/* ================= STORAGE ================= */
const STORAGE_KEY = "ai_huong_nghiep_student";

/* ================= DATA ================= */

/* ===== MI ‚Äì 12 C√ÇU ===== */
const MI_QUESTIONS = [
  { q:"Khi h·ªçc ki·∫øn th·ª©c m·ªõi, em th∆∞·ªùng:", o:{logic:"T√¨m quy lu·∫≠t",language:"Ghi ch√∫ & gi·∫£i th√≠ch",visual:"V·∫Ω s∆° ƒë·ªì",tech:"Th·ª≠ l√†m"} },
  { q:"Khi g·∫∑p b√†i kh√≥, em hay:", o:{logic:"Chia nh·ªè ph√¢n t√≠ch",language:"H·ªèi ng∆∞·ªùi kh√°c",visual:"H√¨nh dung c√°ch gi·∫£i",tech:"Th·ª≠ nhi·ªÅu c√°ch"} },
  { q:"Ho·∫°t ƒë·ªông khi·∫øn em t·∫≠p trung l√¢u nh·∫•t:", o:{logic:"Gi·∫£i to√°n",language:"Vi·∫øt tr√¨nh b√†y",visual:"Thi·∫øt k·∫ø",tech:"L·∫≠p tr√¨nh"} },
  { q:"Em th·∫•y m√¨nh m·∫°nh nh·∫•t ·ªü:", o:{logic:"Suy lu·∫≠n",language:"Di·ªÖn ƒë·∫°t",visual:"H√¨nh ·∫£nh",tech:"C√¥ng c·ª•"} },
  { q:"Khi l√†m vi·ªác nh√≥m, em th∆∞·ªùng:", o:{logic:"Ph√¢n t√≠ch v·∫•n ƒë·ªÅ",language:"Tr√¨nh b√†y √Ω ki·∫øn",visual:"ƒê·ªÅ xu·∫•t √Ω t∆∞·ªüng",tech:"L√†m ph·∫ßn k·ªπ thu·∫≠t"} },
  { q:"Em h·ªçc hi·ªáu qu·∫£ nh·∫•t khi:", o:{logic:"C√≥ c·∫•u tr√∫c r√µ",language:"ƒê∆∞·ª£c th·∫£o lu·∫≠n",visual:"C√≥ h√¨nh ·∫£nh",tech:"ƒê∆∞·ª£c th·ª±c h√†nh"} },
  { q:"M√¥n em d·ªÖ ti·∫øp thu nh·∫•t:", o:{logic:"To√°n/L√Ω",language:"VƒÉn/S·ª≠",visual:"M·ªπ thu·∫≠t",tech:"Tin/C√¥ng ngh·ªá"} },
  { q:"Em th√≠ch gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ b·∫±ng:", o:{logic:"L√Ω tr√≠",language:"Ng√¥n t·ª´",visual:"H√¨nh ·∫£nh",tech:"H√†nh ƒë·ªông"} },
  { q:"Khi ho√†n th√†nh vi·ªác, em th√≠ch nh·∫•t:", o:{logic:"K·∫øt qu·∫£ ƒë√∫ng",language:"ƒê∆∞·ª£c c√¥ng nh·∫≠n",visual:"S·∫£n ph·∫©m ƒë·∫πp",tech:"H·ªá th·ªëng ch·∫°y"} },
  { q:"Khi h·ªçc online, em th∆∞·ªùng:", o:{logic:"L√†m b√†i t·∫≠p",language:"Ghi ch√©p",visual:"Xem s∆° ƒë·ªì",tech:"Th·ª±c h√†nh"} },
  { q:"Em c·∫£m th·∫•y t·ª± tin nh·∫•t khi:", o:{logic:"Gi·∫£i b√†i logic",language:"N√≥i tr∆∞·ªõc l·ªõp",visual:"Thi·∫øt k·∫ø",tech:"Code/l·∫Øp r√°p"} },
  { q:"N·∫øu t·ª± h·ªçc, em s·∫Ω:", o:{logic:"L·∫≠p k·∫ø ho·∫°ch",language:"ƒê·ªçc & vi·∫øt",visual:"V·∫Ω mindmap",tech:"L√†m th·ª≠"} }
];

/* ===== HOLLAND ‚Äì 12 C√ÇU ===== */
const HOLLAND_QUESTIONS = [
  { q:"Em th√≠ch c√¥ng vi·ªác n√†o h∆°n?", o:{R:"S·ª≠a ch·ªØa",I:"Nghi√™n c·ª©u",A:"S√°ng t·∫°o",S:"Gi√∫p ng∆∞·ªùi",E:"Kinh doanh",C:"Qu·∫£n l√Ω"} },
  { q:"M√¥i tr∆∞·ªùng em th√≠ch:", o:{R:"Th·ª±c t·∫ø",I:"Y√™n tƒ©nh",A:"T·ª± do",S:"Giao ti·∫øp",E:"C·∫°nh tranh",C:"Quy tr√¨nh"} },
  { q:"Em th·∫•y h·ª£p h∆°n v·ªõi:", o:{R:"L√†m tay ch√¢n",I:"L√†m tr√≠ √≥c",A:"L√†m ngh·ªá thu·∫≠t",S:"L√†m d·ªãch v·ª•",E:"L√†m l√£nh ƒë·∫°o",C:"L√†m h√†nh ch√≠nh"} },
  { q:"Trong nh√≥m, em mu·ªën l√†:", o:{R:"Ng∆∞·ªùi th·ª±c hi·ªán",I:"Ng∆∞·ªùi ph√¢n t√≠ch",A:"Ng∆∞·ªùi s√°ng t·∫°o",S:"Ng∆∞·ªùi h·ªó tr·ª£",E:"Ng∆∞·ªùi d·∫´n d·∫Øt",C:"Ng∆∞·ªùi t·ªï ch·ª©c"} },
  { q:"C√¥ng vi·ªác em th·∫•y tho·∫£i m√°i:", o:{R:"C√≥ m√°y m√≥c",I:"C√≥ d·ªØ li·ªáu",A:"C√≥ √Ω t∆∞·ªüng",S:"C√≥ con ng∆∞·ªùi",E:"C√≥ m·ª•c ti√™u",C:"C√≥ quy ƒë·ªãnh"} },
  { q:"Em mu·ªën c√¥ng vi·ªác:", o:{R:"Th·ª±c h√†nh nhi·ªÅu",I:"Suy nghƒ© nhi·ªÅu",A:"S√°ng t·∫°o",S:"Gi√∫p √≠ch",E:"Th√†nh c√¥ng",C:"·ªîn ƒë·ªãnh"} },
  { q:"Em th√≠ch m√¥i tr∆∞·ªùng:", o:{R:"X∆∞·ªüng/tr∆∞·ªùng",I:"Ph√≤ng lab",A:"Studio",S:"Tr∆∞·ªùng h·ªçc",E:"Doanh nghi·ªáp",C:"VƒÉn ph√≤ng"} },
  { q:"ƒêi·ªÅu em coi tr·ªçng:", o:{R:"Th·ª±c t·∫ø",I:"Ch√≠nh x√°c",A:"C·∫£m h·ª©ng",S:"√ù nghƒ©a",E:"K·∫øt qu·∫£",C:"Tr·∫≠t t·ª±"} },
  { q:"Em th√≠ch l√†m vi·ªác v·ªõi:", o:{R:"C√¥ng c·ª•",I:"Ki·∫øn th·ª©c",A:"√ù t∆∞·ªüng",S:"Con ng∆∞·ªùi",E:"Ngu·ªìn l·ª±c",C:"H·ªì s∆°"} },
  { q:"Em ph√π h·ª£p v·ªõi:", o:{R:"K·ªπ thu·∫≠t",I:"Khoa h·ªçc",A:"Ngh·ªá thu·∫≠t",S:"Gi√°o d·ª•c",E:"Kinh doanh",C:"K·∫ø to√°n"} },
  { q:"Em mu·ªën c√¥ng vi·ªác:", o:{R:"V·∫≠n ƒë·ªông",I:"T∆∞ duy",A:"T·ª± do",S:"G·∫Øn k·∫øt",E:"ThƒÉng ti·∫øn",C:"·ªîn ƒë·ªãnh"} },
  { q:"Em th√≠ch vai tr√≤:", o:{R:"Th·ª£",I:"Nh√† nghi√™n c·ª©u",A:"Nh√† s√°ng t·∫°o",S:"Ng∆∞·ªùi h·ªó tr·ª£",E:"Ng∆∞·ªùi l√£nh ƒë·∫°o",C:"Ng∆∞·ªùi qu·∫£n l√Ω"} }
];

/* ================= OBJECT ================= */

let student = createEmptyStudent();

function createEmptyStudent(){
  return {
    basicInfo:{},
    preferences:{},
    selfAssessment:{},
    MI:{ score:{logic:0,language:0,visual:0,tech:0}, answers:[] },
    holland:{ score:{R:0,I:0,A:0,S:0,E:0,C:0}, answers:[] },
    SWOT:{}
  };
}

/* ================= STORAGE HANDLER ================= */

function saveStudent(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(student));
}

function loadStudent(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return false;
  try{
    student = JSON.parse(raw);
    return true;
  }catch{
    return false;
  }
}

function resetAll(){
  if(!confirm("Reset to√†n b·ªô d·ªØ li·ªáu?")) return;
  localStorage.removeItem(STORAGE_KEY);
  student = createEmptyStudent();
  location.reload();
}

/* ================= NORMALIZE ================= */

function normalizeProfile(student){
  const topMI = Object.entries(student.MI.score)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,2)
    .map(i=>i[0]);

  const topHolland = Object.entries(student.holland.score)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,3)
    .map(i=>i[0]);

  const hasNoise = /ngu|ƒë·ªãt|m·∫π|cc/i.test(JSON.stringify(student));

  return { topMI, topHolland, hasNoise };
}

/* ================= PROMPT BUILDER ================= */

function buildGeminiPrompt(student){
  return `
B·∫°n l√† C·ªê V·∫§N H∆Ø·ªöNG NGHI·ªÜP cho h·ªçc sinh l·ªõp 12 Vi·ªát Nam.

Y√äU C·∫¶U VAI TR√í:
- Vi·∫øt nh∆∞ m·ªôt th·∫ßy/c√¥ t∆∞ v·∫•n h∆∞·ªõng nghi·ªáp
- Gi·∫£i th√≠ch r√µ r√†ng, d·ªÖ hi·ªÉu
- Kh√¥ng ph√°n x√©t, kh√¥ng ch√™ tr√°ch
- Kh√¥ng nh·∫Øc l·∫°i ho·∫∑c l·∫∑p l·∫°i t·ª´ ng·ªØ ti√™u c·ª±c xu·∫•t hi·ªán trong d·ªØ li·ªáu
- Kh√¥ng d√πng thu·∫≠t ng·ªØ h·ªçc thu·∫≠t kh√≥ hi·ªÉu n·∫øu kh√¥ng c·∫ßn thi·∫øt

M·ª§C TI√äU:
Gi√∫p h·ªçc sinh:
1. Hi·ªÉu r√µ xu h∆∞·ªõng h·ªçc t·∫≠p v√† c√°ch t∆∞ duy c·ªßa b·∫£n th√¢n
2. Hi·ªÉu v√¨ sao m√¨nh ph√π h·ª£p v·ªõi m·ªôt s·ªë nh√≥m ng√†nh nh·∫•t ƒë·ªãnh
3. C√≥ ƒë·ªãnh h∆∞·ªõng h·ªçc t·∫≠p c·ª• th·ªÉ, kh√¥ng m∆° h·ªì
4. C·∫£m th·∫•y y√™n t√¢m h∆°n khi ƒë·ª©ng tr∆∞·ªõc l·ª±a ch·ªçn ng√†nh ngh·ªÅ

========================
TH√îNG TIN H·ªåC SINH

H·ªç t√™n: ${student.basicInfo.name}

--- S·ªû TH√çCH & C√ÅCH H·ªåC ---
- S·ªü th√≠ch n·ªïi b·∫≠t: ${student.preferences.interests?.join(", ") || "Ch∆∞a r√µ"}
- C√°ch h·ªçc hi·ªáu qu·∫£: ${student.preferences.learningStyle}
- M√¥i tr∆∞·ªùng l√†m vi·ªác mong mu·ªën: ${student.preferences.workStyle}
- Kh√≥ khƒÉn khi h·ªçc: ${student.preferences.studyPain || "Kh√¥ng n√™u"}

--- T·ª∞ ƒê√ÅNH GI√Å ---
- T√≠nh c√°ch: ${student.selfAssessment.personality}
- ƒê·∫∑c ƒëi·ªÉm c√° nh√¢n: ${student.selfAssessment.traits?.join(", ") || "Kh√¥ng r√µ"}
- ƒêi·ªÉm m·∫°nh t·ª± nh·∫≠n th·∫•y: ${student.selfAssessment.strengths}
- H·∫°n ch·∫ø ƒëang g·∫∑p ph·∫£i: ${student.selfAssessment.weaknesses}
- ƒêi·ªÅu lo l·∫Øng khi ch·ªçn ng√†nh: ${student.selfAssessment.careerFear || "Kh√¥ng n√™u"}

--- ƒêA TR√ç TU·ªÜ (MI) ---
D∆∞·ªõi ƒë√¢y l√† c√°c c√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi c·ªßa h·ªçc sinh:

${student.MI.answers.map((a,i)=>`${i+1}. ${a.question}\n‚Üí H·ªçc sinh ch·ªçn: ${a.selected}`).join("\n\n")}

T·ªïng h·ª£p MI:
- Logic: ${student.MI.score.logic}
- Ng√¥n ng·ªØ: ${student.MI.score.language}
- Kh√¥ng gian/h√¨nh ·∫£nh: ${student.MI.score.visual}
- K·ªπ thu·∫≠t/th·ª±c h√†nh: ${student.MI.score.tech}

--- M√îI TR∆Ø·ªúNG NGH·ªÄ NGHI·ªÜP (HOLLAND) ---
${student.holland.answers.map((a,i)=>`${i+1}. ${a.question}\n‚Üí H·ªçc sinh ch·ªçn: ${a.selected}`).join("\n\n")}

T·ªïng h·ª£p Holland:
R ${student.holland.score.R}, I ${student.holland.score.I}, A ${student.holland.score.A},
S ${student.holland.score.S}, E ${student.holland.score.E}, C ${student.holland.score.C}

--- SWOT (ch·ªâ ƒë·ªÉ tham kh·∫£o) ---
- ƒêi·ªÉm m·∫°nh: ${student.SWOT.strengths}
- H·∫°n ch·∫ø: ${student.SWOT.weaknesses}
- C∆° h·ªôi: ${student.SWOT.opportunities}
- Th√°ch th·ª©c: ${student.SWOT.threats}

========================
Y√äU C·∫¶U TR·∫¢ L·ªúI:

H√£y vi·∫øt m·ªôt B√ÄI T∆Ø V·∫§N H∆Ø·ªöNG NGHI·ªÜP HO√ÄN CH·ªàNH, g·ªìm c√°c ph·∫ßn sau:

1. **Nh·∫≠n x√©t t·ªïng quan v·ªÅ c√°ch h·ªçc v√† t∆∞ duy c·ªßa h·ªçc sinh**
2. **Ph√¢n t√≠ch ƒëi·ªÉm m·∫°nh n·ªïi b·∫≠t v√† c√°ch ch√∫ng ·∫£nh h∆∞·ªüng ƒë·∫øn l·ª±a ch·ªçn ng√†nh**
3. **G·ª£i √Ω 2‚Äì4 nh√≥m ng√†nh ph√π h·ª£p**, m·ªói nh√≥m:
   - Gi·∫£i th√≠ch v√¨ sao ph√π h·ª£p
   - Ph√π h·ª£p v·ªõi ki·ªÉu h·ªçc v√† t√≠nh c√°ch n√†o
4. **G·ª£i √Ω m·ªôt s·ªë ng√†nh c·ª• th·ªÉ** (mang t√≠nh tham kh·∫£o)
5. **ƒê·ªÅ xu·∫•t l·ªô tr√¨nh h·ªçc t·∫≠p cho l·ªõp 12** (n√™n t·∫≠p trung v√†o nh·ªØng g√¨)
6. **M·ªôt v√†i l·ªùi khuy√™n th·ª±c t·∫ø, nh·∫π nh√†ng v√† d·ªÖ √°p d·ª•ng**

Vi·∫øt b·∫±ng ti·∫øng Vi·ªát, gi·ªçng ƒëi·ªáu t√≠ch c·ª±c, ƒë·ªãnh h∆∞·ªõng, kh√¥ng g√¢y √°p l·ª±c.
`;
}


/* ================= FLOW ================= */

function submitM0(){
  const v = $("name").value.trim();
  if(!v){ alert("Nh·∫≠p t√™n"); return; }

  student.basicInfo.name = v;
  saveStudent();

  $("m0").style.display = "none";
  $("app").classList.remove("hidden");

  showOnly("m1"); // OK, nh∆∞ng ch·ªâ khi showOnly KH√îNG b·ªã INIT ph√°
}




function submitM1(){
  student.preferences = {
    interests:[...document.querySelectorAll('#m1 input[type=checkbox]:checked')].map(i=>i.value),
    learningStyle:document.querySelector('input[name="learning"]:checked')?.value || "",
    workStyle:document.querySelector('input[name="workEnv"]:checked')?.value || "",
    studyPain:$("studyPain").value
  };

  saveStudent();
  showOnly("m2");
}


function submitM2(){
  student.selfAssessment = {
    personality:document.querySelector('input[name="personality"]:checked')?.value || "",
    traits:[...document.querySelectorAll('#m2 input[type=checkbox]:checked')].map(i=>i.value),
    strengths:$("strengths").value,
    weaknesses:$("weaknesses").value,
    careerFear:$("careerFear").value
  };

  saveStudent();
  renderMI();
  showOnly("m3a");
}


/* ================= MI / HOLLAND / SWOT (gi·ªØ nguy√™n logic) ================= */
/* ================= MI ================= */

function renderMI(){
  const container = $("miContainer");
  container.innerHTML = "";

  MI_QUESTIONS.forEach((q, i) => {
    let html = `<div class="question"><b>${i + 1}. ${q.q}</b><br>`;
    for (const key in q.o) {
      html += `
        <label>
          <input type="radio" name="mi_${i}" value="${key}">
          ${q.o[key]}
        </label><br>
      `;
    }
    html += `</div>`;
    container.insertAdjacentHTML("beforeend", html);
  });
}

function submitMI(){
  student.MI.score = { logic:0, language:0, visual:0, tech:0 };
  student.MI.answers = [];

  MI_QUESTIONS.forEach((q, i) => {
    const selected = document.querySelector(`input[name="mi_${i}"]:checked`);
    if (selected) {
      student.MI.score[selected.value]++;
      student.MI.answers.push({
        question: q.q,
        selected: q.o[selected.value],
        type: selected.value
      });
    }
  });

  saveStudent();
  renderHolland();
  go("m3a", "m3b");
}

/* ================= HOLLAND ================= */

function renderHolland(){
  const container = $("hollandContainer");
  container.innerHTML = "";

  HOLLAND_QUESTIONS.forEach((q, i) => {
    let html = `<div class="question"><b>${i + 1}. ${q.q}</b><br>`;
    for (const key in q.o) {
      html += `
        <label>
          <input type="radio" name="hol_${i}" value="${key}">
          ${q.o[key]}
        </label><br>
      `;
    }
    html += `</div>`;
    container.insertAdjacentHTML("beforeend", html);
  });
}

function submitHolland(){
  student.holland.score = { R:0, I:0, A:0, S:0, E:0, C:0 };
  student.holland.answers = [];

  HOLLAND_QUESTIONS.forEach((q, i) => {
    const selected = document.querySelector(`input[name="hol_${i}"]:checked`);
    if (selected) {
      student.holland.score[selected.value]++;
      student.holland.answers.push({
        question: q.q,
        selected: q.o[selected.value],
        type: selected.value
      });
    }
  });

  saveStudent();
  go("m3b", "m3c");
}

/* ================= SWOT ================= */

function submitSWOT(){
  student.SWOT = {
    strengths: $("swot_strengths").value,
    weaknesses: $("swot_weaknesses").value,
    opportunities: $("swot_opportunities").value,
    threats: $("swot_threats").value
  };

  saveStudent();

  // üëâ Chuy·ªÉn th·∫≥ng sang trang ph√¢n t√≠ch
  window.location.href = "analyze.html";
}


/* ================= DEBUG ================= */

function showDebug(){
  go("m3c","debug");
  $("debugData").textContent = JSON.stringify(student,null,2);
  $("promptData").textContent = buildGeminiPrompt(student);
  saveStudent();
}

/* ================= INIT ================= */


document.addEventListener("keydown", e=>{
  if(e.key === "Enter"){
    const m0 = document.getElementById("m0");
    if(m0 && !m0.classList.contains("hidden")){
      submitM0();
    }
  }
});

window.addEventListener("load",()=>{
  const hasData = loadStudent();

  if(hasData && student.basicInfo?.name){
    $("m0").style.display = "none";
    $("app").classList.remove("hidden");
    showOnly("m1");
  }else{
    $("m0").style.display = "flex"; // intro overlay
    $("app").classList.add("hidden");
  }
});


</script>

</body>
</html>


